<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

    <style>
        .abilityList {
            display: grid;
            grid-template-columns: 50px 300px 100px 100px;
        }
        .abilityRow {
            display: grid;
            grid-template-columns: 100px 400px 150px 150px;
        }
        .abilityCost, .abilityBenefit, .abilityName {
            margin-left: 10px;
            font-weight: bold;
            display: flex;
            justify-content: left;
            align-items: center;
        }

        .a .abilityName {
            color: rgb(230, 161, 161);
        }
        
        .b .abilityName {
            color: rgb(159, 247, 159);
        }
        .a, .b {
            display: grid;
            grid-template-columns: 200px 100px 100px;
        }
        
        #remaining {
            display: none;
        }
    </style>
    <script src="abilities.js"></script>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col">
                <h1>Hades Ability Calculator</h1>

                <div class="abilityContainer">
                    <div id="starting">
                        Starting amount:<br><input id="startingAmount" type="text">
                    </div>
                    <div class="abilityList">
                        <div id="switches"></div>
                        <div id="names">test</div>
                        <div id="benefits">test</div>
                        <div id="costs">test</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                Total Cost: <span id="totalCost">0</span>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <div id="remaining">
                    Remaining: <span id="remainingAmount">0</span>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
        crossorigin="anonymous"></script>

    <script>
        $(function () {
            addSwitchButtons(ABILITY_DATA[0]);

            $('#startingAmount').keyup(function() {
                if ($(this).val() != '') {
                    $('#remaining').show();
                    let startingAmount = Number.parseInt($(this).val());
                    let costAmount = Number.parseInt($('#totalCost').text());

                    $('#remainingAmount').text(startingAmount - costAmount);
                } else {
                    $('#remaining').hide();
                }
            });

            for (row of ABILITY_DATA) {
                addSwitchButtons(row);
                buildRow(row);
            }

            $('.b').each(function() {
                $(this).hide();
            });
        });

        function resetRow(rowNum) {
            let abilityA = '#row-' + rowNum + ' .a';
            let abilityB = '#row-' + rowNum + ' .b';
            $(abilityA).toggle();
            $(abilityB).toggle();

            $('#row-' + rowNum + ' input').each(function (i, e) {
                $(this).prop('checked', false);
            });

            $(`#${rowNum}-a-00`).prop('checked', true);
            $(`#${rowNum}-b-00`).prop('checked', true);
            $(`#${rowNum}-a-max`).hide();
            $(`#${rowNum}-b-max`).hide();

            $('#cost-' + rowNum).text('0');
            $('#benefit-' + rowNum).text('0');
            calculateTotalCost();
        }

        function calculateTotalCost() {
            let totalAmount = 0;
            $('input:checked').each(function () {
                totalAmount += Number.parseInt($(this).val());
            });
            $('#totalCost').text(totalAmount);
        }

        function addSwitchButtons(data) {
            let switchImage = `<img src="img/button-switch.png" id="switch-${data.row}" data-row=${data.row} />`;

            $('img').appendTo($('#switches'));

            //         .attr({
            //             id: `switch-${data.row}`,
            //             'data-row': data.row,
            //             src: 'img/button-switch.png'
            //         }).click(function (e) {
            //             resetRow(e.currentTarget.dataset['row']);
            //         }
            //     )
            // );
        }

        function buildRow(data) {
            let abilityRow = $('<div>').attr({
                class: 'abilityRow',
                id: `row-${data.row}`
            });

            abilityRow
                .append(buildAbility(data.a, data.row, 'a'))
                .append(buildAbility(data.b, data.row, 'b'))
                .append($('<div>').addClass('abilityCost').html(`<span id="cost-${data.row}">Cost: 0</span>`))
                .append($('<div>').addClass('abilityBenefit').html(`<span id="benefit-${data.row}">Benefit: 0</span>`));

            $('.abilityList').append(abilityRow);
        }

        function buildAbility(data, row, option) {
            let ability = $('<div>').addClass(option);
            ability.append($('<span>').addClass('abilityName').text(data.name));
            let count = 0;

            for (rank of data.ranks) {
                let formCheck = $('<div>').addClass('form-check-inline');
                let rankNumber = count.toString().padStart(2, '0');

                let input = $('<input>').attr({
                    type: 'radio',
                    value: rank.costTotal,
                    class: 'form-check-input',
                    name: `${row}-${option}`,
                    id: `${row}-${option}-${rankNumber}`
                }).click(function () {
                    let rowNum = $(this).attr('name').substr(0, 2);
                    let thisID = $(this).attr('id');

                    $('#cost-' + rowNum).text(`Cost: ${$(this).val()}`);
                    $('#benefit-' + rowNum).text(`Benefit: ${$('label[for="' + thisID + '"]').text()}`);
                    calculateTotalCost();

                    let nextNum = Number.parseInt(thisID.substr(thisID.length - 2)) + 1;
                    nextNum = nextNum.toString().padStart(2, '0');

                    let nextRankMaybe = '#' + thisID.substr(0, thisID.length - 2) + nextNum;
                    let max = $(`#${rowNum}-${option}-max`);

                    if ($(nextRankMaybe).length != 0) {
                        max.hide();
                    } else {
                        max.show();
                    }

                    $('#startingAmount').trigger('keyup');
                });

                input.val() == "0" ? input.attr('checked', true) : input.attr('checked', false);

                let label = $('<label>').attr({
                    class: 'form-check-label',
                    for: `${row}-${option}-${rankNumber}`
                }).text(rank.costLabel);

                formCheck.append(input).append(label).attr('style', 'display: none;');
                ability.append(formCheck);
                count++;
            }

            let addButton = $('img').attr({
                src: 'img/button-add.png',
                id: `${row}-${option}-add`
            }).click(function (e) {
                let inputs = $(`input[name="${row}-${option}"]`);

                for (let i = 0; i < inputs.length; i++) {
                    if (inputs[i].checked == true) {
                        $(inputs[i]).attr('checked', false);

                        if (i == inputs.length - 1) {
                            $(inputs[0]).attr('checked', true).trigger('click');
                            return;
                        } else {
                            $(inputs[i + 1]).attr('checked', true).trigger('click');
                            return;
                        }
                    }
                }
            });

            ability.append(addButton).append($('<div>').attr('id', `${row}-${option}-max`).text('MAX').hide());;

            return ability;
        }
    </script>
</body>

</html>